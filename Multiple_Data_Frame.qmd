---
title: "Multiple Data Frames"
author: "Chlo√© Marquis"
format: html
---

```{r}
here::i_am("dm-course-git-101-c.Rproj")
library(here)
```

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(vroom)
```

```{r}
planets <- vroom(here("data", "Planets.csv"))
stars <- vroom(here("data", "thestars.csv"))
```
```{r}
sun_to_earth <- 333000
```


# Planet oriented analysis 

We look for the planet that has the largest ratio between its mass and the mass of its star. We cannot do that using the planets date frame only, we need to join it with the stars data frame. 

### Inner Join

In an inner join, we keep only matches between the two data frames (according to the join_by variables). 
```{r}
planet_star <- inner_join(planets, stars, by = join_by(star_key))
```

```{r}
planet_star |>
  mutate(mass_ratio = MASS/(`Relative Mass`*sun_to_earth)) |>
  slice_max(mass_ratio)|>
  select(planet=p_name, star=STAR, mass_ratio)
```

### Semi and anti join 

```{r}
planet_without_star <- anti_join(planets, stars, by = join_by(star_key))
stars_without_planet <- anti_join(stars, planets, by = join_by(star_key))
```

```{r}
stars_with_planets <- semi_join(stars, planets, by = join_by(star_key)) 
```

-> stars with at least one planet in the data frame 
We have `r nrow(planets_without_star)` planets without a corresponding star in the datebase and `r nrow(stars_without_planet)` stars without planets described in the database.

### Left and right join 
Keep the planets even if they don't have a corresponding star -> use an outer join. 
Left join : keep all data from first param even if they don't have a match in the second param 
Full join will keep everything.

```{r}
all_planets <- left_join(planets, stars, by=join_by(star_key))
all_stars <- right_join(planets, stars, by=join_by(star_key))
all_all <- full_join(planets, stars, by=join_by(star_key))
```


